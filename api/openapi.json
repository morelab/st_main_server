{
  "openapi": "3.0.0",
  "info": {
    "contact": {
      "email": "koldo.urrosolo@opendeusto.es"
    },
    "title": "Main_Server (API-GATEWAY)",
    "description": "API Gateway encargada de la gestión de los usuarios. Además, ofrece la posibilidad de realizar peticiones a las API de equivalencias y de los smartpugs.",
    "version": "1.0.0"
  },
  "servers": [
    {
      "description": "Development server",
      "url": "http://localhost:8876/"
    }
  ],
  "tags": [
    {
      "description": "Gestión de los usuarios",
      "name": "Users"
    },
    {
      "description": "Gestión de inicio de sesión",
      "name": "Authentication"
    },
    {
      "description": "APIs externas",
      "name": "External"
    }
  ],
  "paths": {
    "/login": {
      "post": {
        "description": "Inicio de sesión del usuario",
        "operationId": "logIn",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/login"
              }
            }
          },
          "description": "Información de inicio de sesión del usuario"
        },
        "security": [],
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/loginResponse"
                }
              }
            },
            "description": "Estado de la operación",
            "headers": {
              "Set-Cookie": {
                "schema": {
                  "type": "string",
                  "example": "access_token=1231241244125123waesdfr12341; Paht=/; HttpOnly"
                }
              }
            }
          }
        },
        "summary": "Inicio de sesión del usuario",
        "tags": [
          "Authentication"
        ]
      }
    },
    "/signup": {
      "post": {
        "description": "Registro del usuario",
        "operationId": "signUp",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/signup"
              }
            }
          },
          "description": "Información para crear el usuario"
        },
        "security": [],
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/signupOk"
                }
              }
            },
            "description": "Información sobre la creación del usuario"
          },
          "403": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/signupError"
                }
              }
            },
            "description": "Usuario ya existente"
          }
        },
        "summary": "Información sobre el error al crear el usuario",
        "tags": [
          "Authentication"
        ]
      }
    },
    "/dashboard": {
      "get": {
        "operationId": "dashboard",
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/dashboard"
                }
              }
            },
            "description": "Datos de consumo del usuario"
          }
        },
        "description": "Obtiene la información del dashboard del usuario",
        "tags": [
          "Users"
        ]
      }
    },
    "/getSmartplug": {
      "post": {
        "description": "Comprubea si el smartplug está asignado a otro usuario",
        "operationId": "smartplug",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/smartplug"
              }
            }
          },
          "description": "Smartplug location"
        },
        "security": [],
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/smartplugOk"
                }
              }
            },
            "description": "Alias asociado al smartplug"
          },
          "403": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/smartplugErr"
                }
              }
            },
            "description": "El smartplug lo tiene asignado otro usuario"
          },
          "406": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/smartplugErr"
                }
              }
            },
            "description": "No se ha encontrado el smartplug"
          }
        },
        "tags": [
          "Authentication"
        ]
      }
    },
    "/logout": {
      "description": "Cierra la sesión del usuario",
      "post": {
        "operationId": "logOut",
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/logout"
                }
              }
            },
            "description": "Mensaje de cierre de sesión"
          }
        },
        "tags": [
          "Authentication"
        ]
      }
    },
    "/clearCookie": {
      "description": "Cierra la sesión del usuario",
      "post": {
        "operationId": "clearCookie",
        "security": [],
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/logout"
                }
              }
            },
            "description": "Mensaje de eliminación de cookie"
          }
        },
        "tags": [
          "Authentication"
        ]
      }
    },
    "/profile": {
      "description": "Información del usuario",
      "get": {
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/profile"
                }
              }
            },
            "description": "Información del usuario"
          }
        },
        "tags": [
          "Users"
        ]
      },
      "delete": {
        "description": "Elimina el usuario de la base de datos",
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/success"
                }
              }
            },
            "description": "Mensaje de eliminación de cookie"
          }
        },
        "tags": [
          "Users"
        ]
      }
    },
    "/anon": {
      "get": {
        "operationId": "changeStatus",
        "description": "Cambia el usuario de anonimo a público y vice versa",
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/success"
                }
              }
            },
            "description": "Estado del cambio"
          }
        },
        "tags": [
          "Users"
        ]
      }
    },
    "/status": {
      "get": {
        "operationId": "checkAuth",
        "description": "Valida el usuario",
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/success"
                }
              }
            },
            "description": "Estado del cambio"
          }
        },
        "tags": [
          "Authentication"
        ]
      }
    },
    "/smartplugSwitch": {
      "get": {
        "description": "Enciende o apaga el smartplug en función de su estado actual",
        "operationId": "smartplugSwitch",
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/success"
                }
              }
            },
            "description": "Mensaje de estado"
          },
          "404": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/smartplugNoEncontrado"
                }
              }
            },
            "description": "No se ha encontrado el smartplug"
          },
          "default": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/success"
                }
              }
            },
            "description": "Respuesta por defecto"
          }
        },
        "summary": "Enciende el smartplug",
        "tags": [
          "External"
        ]
      }
    }
  },
  "security": [
    {
      "cookieAuth": []
    }
  ],
  "components": {
    "securitySchemes": {
      "cookieAuth": {
        "type": "apiKey",
        "in": "cookie",
        "name": "access_token"
      }
    },
    "schemas": {
      "smartplugOk": {
        "additionalProperties": false,
        "type": "object",
        "properties": {
          "alias": {
            "type": "string"
          }
        }
      },
      "smartplugErr": {
        "additionalProperties": false,
        "type": "object",
        "properties": {
          "err": {
            "type": "string"
          }
        }
      },
      "dashboard": {
        "additionalProperties": false,
        "properties": {
          "monthData": {
            "type": "array",
            "items": {
              "properties": {
                "timestamp": {
                  "type": "number"
                },
                "v": {
                  "type": "number",
                  "description": "value"
                }
              }
            }
          },
          "weekData": {
            "type": "array",
            "items": {
              "properties": {
                "timestamp": {
                  "type": "number"
                },
                "v": {
                  "type": "number",
                  "description": "value"
                }
              }
            }
          },
          "yesterdayData": {
            "type": "array",
            "items": {
              "properties": {
                "timestamp": {
                  "type": "number"
                },
                "v": {
                  "type": "number",
                  "description": "value"
                }
              }
            }
          },
          "todayData": {
            "type": "array",
            "items": {
              "properties": {
                "timestamp": {
                  "type": "number"
                },
                "v": {
                  "type": "number",
                  "description": "value"
                }
              }
            }
          },
          "user": {
            "type": "object"
          }
        }
      },
      "login": {
        "additionalProperties": false,
        "properties": {
          "user": {
            "description": "Nombre de usuario\n",
            "maxLength": 100,
            "type": "string"
          },
          "pass": {
            "description": "Contraseña del usuario\n",
            "maxLength": 100,
            "type": "string"
          }
        },
        "type": "object"
      },
      "loginResponse": {
        "additionalProperties": false,
        "properties": {
          "success": {
            "description": "Indicador si se ha iniciado sesión correctamente o no\n",
            "type": "boolean"
          }
        },
        "type": "object"
      },
      "signup": {
        "additionalProperties": false,
        "properties": {
          "user": {
            "description": "Nombre de usuario\n",
            "maxLength": 100,
            "type": "string"
          },
          "pass": {
            "description": "Contraseña del usuario\n",
            "maxLength": 100,
            "type": "string"
          },
          "anonymous": {
            "description": "Si el usuario quiere aparecer como anonimo",
            "type": "boolean"
          },
          "name": {
            "description": "Nombre del usuario",
            "type": "string"
          },
          "priv": {
            "description": "Nivel del privilegio del usuario",
            "type": "number"
          },
          "profile": {
            "description": "Información estadística sobre el usaurio",
            "properties": {
              "age": {
                "type": "number"
              },
              "city": {
                "type": "number"
              },
              "big_5": {
                "type": "number"
              },
              "gender": {
                "type": "number"
              },
              "position": {
                "type": "number"
              },
              "barriers": {
                "type": "number"
              },
              "education": {
                "type": "number"
              },
              "intentions": {
                "type": "number"
              },
              "pst_profile": {
                "type": "number"
              },
              "work_culture": {
                "type": "number"
              },
              "pst_self_profile": {
                "type": "number"
              },
              "initiative_to_join": {
                "type": "number"
              }
            },
            "type": "object"
          },
          "devices": {
            "type": "array",
            "items": {
              "properties": {
                "name": {
                  "type": "string"
                }
              },
              "type": "object"
            }
          },
          "smartplug": {
            "type": "object",
            "properties": {
              "name": {
                "type": "string"
              },
              "location": {
                "type": "string"
              },
              "in_use": {
                "type": "boolean"
              }
            }
          }
        },
        "type": "object"
      },
      "signupOk": {
        "properties": {
          "success": {
            "description": "Indicador si se ha creado la cuenta correctamente\n",
            "type": "boolean"
          }
        },
        "type": "object"
      },
      "signupError": {
        "additionalProperties": false,
        "properties": {
          "err": {
            "description": "Error debido a que el nombre de usuario y está en uso \n",
            "type": "string"
          }
        },
        "type": "object"
      },
      "logout": {
        "properties": {
          "success": {
            "description": "Cookie eliminada\n",
            "type": "boolean"
          }
        },
        "type": "object"
      },
      "profile": {
        "additionalProperties": false,
        "properties": {
          "user": {
            "type": "object"
          }
        },
        "type": "object"
      },
      "success": {
        "properties": {
          "success": {
            "type": "boolean"
          }
        },
        "type": "object"
      },
      "smartplugNoEncontrado": {
        "additionalProperties": false,
        "properties": {
          "msg": {
            "description": "Smartplug no se ha encontrado",
            "maxLength": 29,
            "minLength": 29,
            "pattern": "[a-zA-Z\\s]+",
            "type": "string"
          }
        },
        "readOnly": true,
        "type": "object"
      },
      "smartplug": {
        "additionalProperties": false,
        "properties": {
          "location": {
            "description": "Ubicación donde se encuentra el smartplug. Tiene el siguiente formato: sp_w.r{Fila}.c{Columna} *Hay que sustituir el valor de Fila y Columna por el correspondiente.\n",
            "maxLength": 12,
            "pattern": "sp_w.r\\d{1,2}.c\\d{1,2}",
            "type": "string"
          }
        },
        "type": "object"
      }
    }
  }
}